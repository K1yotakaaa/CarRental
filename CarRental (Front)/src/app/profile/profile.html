<div class="profile-dashboard">

  <aside class="sidebar">
    <div class="sidebar-header">Account</div>

    <div class="sidebar-user">
      <div class="sidebar-avatar">
        <img *ngIf="avatarPreview" [src]="avatarPreview" />
        <div *ngIf="!avatarPreview" class="placeholder">No Avatar</div>
      </div>
      <div class="sidebar-name">{{ profile.fullName || 'User' }}</div>
      <div class="sidebar-email">{{ profile.email }}</div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-item active">Profile Overview</div>
      <div class="nav-item">Rental History</div>
      <div class="nav-item">Notifications</div>
      <div class="nav-item">Security</div>
    </nav>
  </aside>

  <main class="profile-content">

    <section class="profile-header">
      <div class="avatar-large avatar-hover-container" (click)="triggerAvatarUpload()">

        <img *ngIf="avatarPreview" [src]="avatarPreview" />
        <div *ngIf="!avatarPreview" class="ph">Upload Avatar</div>

        <div class="avatar-hover-text">Change</div>

      </div>

      <input id="uploadInput" type="file" hidden (change)="onAvatarSelected($event)" />

      <div class="avatar-actions">
        <label for="uploadInput" class="btn-primary">Upload</label>

        <button *ngIf="avatarPreview" class="btn-danger" (click)="removeAvatar()">Remove</button>
      </div>

      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-number">{{ 3 }}</div>
          <div class="stat-label">Total Rentals</div>
        </div>
        <div class="stat-box">
          <div class="stat-number">{{ 12 }}</div>
          <div class="stat-label">Favorites</div>
        </div>
        <div class="stat-box">
          <div class="stat-number">{{ 4.9 }}</div>
          <div class="stat-label">Rating</div>
        </div>
      </div>
    </section>

    <section class="info-section">

      <h2 class="section-title">Personal Information</h2>

      <div class="info-grid">

        <div class="info-item">
          <div class="info-label">Full Name</div>

          <div *ngIf="!editingName" class="info-value">
            {{ profile.fullName || 'Not provided' }}
          </div>

          <input
            *ngIf="editingName"
            [(ngModel)]="editFullName"
            class="edit-input"
            placeholder="Enter your name"
          />

          <div class="info-actions">
            <button *ngIf="!editingName" class="btn-edit" (click)="startEditingName()">Edit</button>
            <button *ngIf="editingName" class="btn-save" (click)="saveName()">Save</button>
            <button *ngIf="editingName" class="btn-cancel" (click)="cancelEditingName()">Cancel</button>
          </div>
        </div>

        <div class="info-item">
          <div class="info-label">User ID</div>
          <div class="info-value">{{ profile.userId }}</div>
        </div>

        <div class="info-item">
          <div class="info-label">Membership</div>
          <div class="info-value">Standard User</div>
        </div>

        <div class="info-item">
          <div class="info-label">Joined</div>
          <div class="info-value">January 2025</div>
        </div>

      </div>

      <button class="logout-btn" (click)="logout()">Logout</button>

    </section>

    <section class="favorites-section" *ngIf="favoriteCars?.length">
      <h2 class="section-title">Your Favorites</h2>

      <div class="favorites-grid">
        <div class="fav-card" *ngFor="let car of favoriteCars">
          <img [src]="car.image || car.image_file" class="fav-img" />

          <div class="fav-info">
            <h3>{{ car.make }}</h3>
            <p>{{ car.type }} â€¢ {{ car.fuel_type }}</p>
            <div class="price">${{ car.price }}</div>
          </div>

          <button class="remove-btn" (click)="removeFavorite(car.id)">
            Remove
          </button>
        </div>
      </div>
    </section>

    <section *ngIf="favoriteCars?.length === 0" class="no-fav">
      <h3>You have no favorites yet</h3>
      <p>Browse cars and click the heart icon to add them.</p>
    </section>

  </main>

</div>
